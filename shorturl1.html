<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LinkShare Short URL Tool</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
  <div id="app" style="display:none;">
    <h2>Short URL Generator</h2>
    <input type="text" id="longUrl" placeholder="Enter long URL" style="width:300px;" />
    <button onclick="generateShortUrl()">Generate Short URL</button>
    <p id="result"></p>
  </div>

  <script>
    // ✅ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyB1Nejcpv0jubaq85ufjZwll-k62aIjFuQ",
      authDomain: "short-url-generator-9ab67.firebaseapp.com",
      databaseURL: "https://short-url-generator-9ab67-default-rtdb.firebaseio.com",
      projectId: "short-url-generator-9ab67",
      storageBucket: "short-url-generator-9ab67.appspot.com",
      messagingSenderId: "375644970022",
      appId: "1:375644970022:web:be24008ed6f3a57a66dae7",
      measurementId: "G-1Q7PCGD8TM"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ✅ Check if user is visiting a short URL path (like /bT931G)
    const path = window.location.pathname.slice(1); // remove leading slash
    if (path) {
      // This is a short ID, attempt to fetch and redirect
      db.ref('short_urls/' + path).once('value').then(snapshot => {
        const data = snapshot.val();
        if (data && data.original) {
          window.location.href = data.original;
        } else {
          document.body.innerHTML = "<h2>404 - Short URL not found</h2>";
        }
      }).catch(err => {
        console.error(err);
        document.body.innerHTML = "<h2>Error loading short link</h2>";
      });
    } else {
      // Show the shortener tool
      document.getElementById('app').style.display = 'block';
    }

    // ✅ Generate Short URL Function
    function generateShortUrl() {
      const longUrl = document.getElementById("longUrl").value.trim();
      if (!longUrl) {
        alert("Please enter a valid URL.");
        return;
      }

      const shortId = Math.random().toString(36).substring(2, 8); // e.g. "bT931G"

      db.ref('short_urls/' + shortId).set({
        original: longUrl
      }).then(() => {
        const shortUrl = `${window.location.origin}/${shortId}`;
        document.getElementById("result").innerHTML = `Short URL: <a href="${shortUrl}" target="_blank">${shortUrl}</a>`;
      }).catch(err => {
        console.error("Error saving to Firebase:", err);
        alert("Something went wrong while saving the link.");
      });
    }
  </script>
</body>
</html>
